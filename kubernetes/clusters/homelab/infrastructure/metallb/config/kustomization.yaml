apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - namespace.yaml
  - ipaddresspool.yaml
  - l2advertisement.yaml

configMapGenerator:
  - name: metallb-params
    namespace: metallb-system
    envs:
      - params.env

generatorOptions:
  disableNameSuffixHash: true

replacements:
  - source:
      kind: ConfigMap
      name: metallb-params
      namespace: metallb-system
      fieldPath: data.METALLB_ADDRESS_RANGE
    targets:
      - select:
          kind: IPAddressPool
          name: vlan-pool
          namespace: metallb-system
        fieldPaths:
          - spec.addresses.0
