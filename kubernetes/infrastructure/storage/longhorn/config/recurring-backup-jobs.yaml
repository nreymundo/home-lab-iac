# Longhorn Recurring Backup Jobs
# Volumes opt-in via PVC labels:
#   recurring-job.longhorn.io/source: enabled       (indicates source for backup)
#   recurring-job.longhorn.io/backup-daily: enabled  (enables daily backup job)
#   recurring-job.longhorn.io/backup-weekly: enabled (enables weekly backup job)
#
# To apply labels, use the backup-policy kustomize component in app kustomizations:
#   components:
#     - ../../../../components/storage/backup-policy
---
apiVersion: longhorn.io/v1beta2
kind: RecurringJob
metadata:
  name: backup-daily
  namespace: longhorn-system
spec:
  name: backup-daily
  task: backup
  cron: "0 3 * * *"
  retain: 14
  concurrency: 2
  labels:
    backup-schedule: daily
---
apiVersion: longhorn.io/v1beta2
kind: RecurringJob
metadata:
  name: backup-weekly
  namespace: longhorn-system
spec:
  name: backup-weekly
  task: backup
  cron: "0 4 * * 0"
  retain: 4
  concurrency: 1
  labels:
    backup-schedule: weekly
