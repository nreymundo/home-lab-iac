---
- name: Download K3s binary for upgrade
  ansible.builtin.get_url:
    url: "https://github.com/k3s-io/k3s/releases/download/{{ k3s_version }}/{{ item.name }}"
    dest: /usr/local/bin/k3s
    mode: "0755"
    checksum: "sha256:{{ item.checksum }}"
    timeout: 120
  become: true
  loop:
    - { arch: 'x86_64', name: 'k3s', checksum: "{{ k3s_amd64_checksum }}" }
    - { arch: 'aarch64', name: 'k3s-arm64', checksum: "{{ k3s_arm64_checksum }}" }
  when: ansible_architecture == item.arch

- name: Restart K3s service after upgrade
  ansible.builtin.systemd_service:
    name: k3s
    state: restarted
    daemon_reload: true
  become: true
